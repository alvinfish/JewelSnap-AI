# JewelSnap V3.2 技术实现方案与修改记录

## 1. 系统概览
JewelSnap 是一款专为饰品电商设计的高清抽帧工具，核心目标是在保持用户隐私的前提下，从视频中智能提取最清晰的商品图。系统采用纯客户端架构，无需后端支持。

## 2. 核心技术栈
- **核心框架**: React 19 + Tailwind CSS
- **媒体处理**: HTML5 Video API + Canvas API
- **核心算法**: 拉普拉斯方差算子 (Laplacian Variance) 图像评价算法
- **导出方案**: Web Share API (iOS 适配) + JSZip (PC 批量)

## 3. 关键技术细节

### 3.1 智能抽帧逻辑 (120 帧深度扫描)
1. **分段策略**: 视频被均分为 5 个片段。
2. **采样频率**: 每个片段进行 24 次等距寻帧，总计 120 个样本点。
3. **分层筛选**: 
   - 片段级：选取每个片段中得分最高的前 3 名。
   - 全局级：选取表现最突出的 Top 5 作为最终推荐。

### 3.2 图像清晰度评价 (Laplacian Variance)
通过对图像进行灰度化处理并应用拉普拉斯卷积核，计算图像二阶导数的方差。方差越大，代表图像边缘越尖锐，即图像越清晰。

### 3.3 输出规格
- **分辨率**: 100% 还原视频原始分辨率（支持 1080P, 2K, 4K）。
- **格式**: JPEG (质量 0.9)，在体积与饰品金属质感间取得平衡。
- **色彩**: sRGB。

---

## 4. 修改历史记录 (Changelog)

### [V3.2.1] - 2025-12-28 (最新修改)
**修复问题**: iPhone 用户点击“保存到相册”时，图片进入 Safari 下载列表或“文件”夹，且无法批量保存。
**技术方案**:
- **引入 Web Share API**: 在 iOS Safari 环境下，不再通过点击模拟下载链接（Blob URL），而是直接调用 `navigator.share`。
- **批量文件分享**: 将 5 张 Base64 图像转换为 `File` 对象数组，一次性唤起系统分享面板。
- **效果**: 用户可在面板中点击“存储 5 张图像”，直接将高清图批量存入手机原生相册。

### [V3.2.0] - 2025-12-28
**修复问题**: iPhone 处理高清视频异常缓慢（超过 15 分钟），UI 假死。
**技术方案**:
- **双画布机制 (Dual-Canvas)**:
  - **分析画布 (Analysis)**: 固定为 640px 宽度，仅用于计算分值。计算量降低约 90%。
  - **捕获画布 (Capture)**: 仅在确定获胜帧后，按视频原比例执行单次渲染。
- **内存优化**: 扫描阶段仅保存得分和时间戳，不生成 Base64 图片，极大缓解了移动端内存压力。

### [V3.1.0] - 2025-12-27
**功能新增**: 
- 引入拉普拉斯方差算法代替简单的间隔抽帧。
- 增加产品名称批量重命名功能。

### [V3.0.0] - 2025-12-25
**初始版本**: 
- 实现基础的视频上传、Canvas 截图及 ZIP 导出功能。

---

## 5. 待优化项
- [ ] 接入 Web Workers 进行并行计算，进一步提升 4K 视频分析速度。
- [ ] 增加 EXIF 元数据写入，方便商家管理图片版权。
- [ ] 适配更多饰品场景（如：自动识别莫桑钻火彩最亮的瞬间）。
